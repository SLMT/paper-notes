<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SIGMOD&#x27;21 - MB2 - Paper Notes</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../cover.html">Cover</a></li><li class="chapter-item expanded affix "><a href="../template.html">Template</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../dbms_machine_provisioning/summary.html"><strong aria-hidden="true">1.</strong> DBMS Workload Modeling &amp; Machine Provisioning</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dbms_machine_provisioning/sheikh2011bayesian.html"><strong aria-hidden="true">1.1.</strong> ICAC'11 - Modeling Workloads using Gaussian Process</a></li><li class="chapter-item expanded "><a href="../dbms_machine_provisioning/taft2018pstore.html"><strong aria-hidden="true">1.2.</strong> SIGMOD'18 - P-Store</a></li></ol></li><li class="chapter-item expanded "><a href="../dbms_data_partitioning/summary.html"><strong aria-hidden="true">2.</strong> DBMS Data Partitioning</a></li><li class="chapter-item expanded "><a href="../dbms_query_processing/summary.html"><strong aria-hidden="true">3.</strong> DBMS Query Processing</a></li><li class="chapter-item expanded "><a href="../dbms_scalability/summary.html"><strong aria-hidden="true">4.</strong> DBMS Scalability</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dbms_scalability/lu2019star.html"><strong aria-hidden="true">4.1.</strong> VLDB'19 - Star</a></li><li class="chapter-item expanded "><a href="../dbms_scalability/georgiou2020hihooi.html"><strong aria-hidden="true">4.2.</strong> TKDE'20 - Hihooi</a></li></ol></li><li class="chapter-item expanded "><a href="../deterministic_dbms/summary.html"><strong aria-hidden="true">5.</strong> Deterministic DBMS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deterministic_dbms/ren2014evaluation.html"><strong aria-hidden="true">5.1.</strong> VLDB'14 - Advantages and Disadvantages of Deterministic DBMS</a></li><li class="chapter-item expanded "><a href="../deterministic_dbms/lu2020aria.html"><strong aria-hidden="true">5.2.</strong> VLDB'20 - Aria</a></li></ol></li><li class="chapter-item expanded "><a href="../dbms_with_ai/summary.html"><strong aria-hidden="true">6.</strong> DBMS + AI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dbms_with_ai/aken2017ottertune.html"><strong aria-hidden="true">6.1.</strong> SIGMOD'17 - OtterTune</a></li><li class="chapter-item expanded "><a href="../dbms_with_ai/marcus2019dlquery.html"><strong aria-hidden="true">6.2.</strong> CIDR'19 - Query Optimizer through DL</a></li><li class="chapter-item expanded "><a href="../dbms_with_ai/zhou2020dbaisurvey.html"><strong aria-hidden="true">6.3.</strong> TKDE'20 - Database Meets AI: A Survey</a></li><li class="chapter-item expanded "><a href="../dbms_with_ai/lin2021mb2.html" class="active"><strong aria-hidden="true">6.4.</strong> SIGMOD'21 - MB2</a></li><li class="chapter-item expanded "><a href="../dbms_with_ai/hilprecht2022zeroshot.html"><strong aria-hidden="true">6.5.</strong> CIDR'22 - Zero-Shot Learning on DBMS</a></li><li class="chapter-item expanded "><a href="../dbms_with_ai/sioulas2021roulette.html"><strong aria-hidden="true">6.6.</strong> SIGMOD'21 - Scalable Multi-Query Execution using Reinforcement Learning</a></li></ol></li><li class="chapter-item expanded "><a href="../rl_to_rank/summary.html"><strong aria-hidden="true">7.</strong> Reinforcement Learning to Rank</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rl_to_rank/zhou2020rlirank.html"><strong aria-hidden="true">7.1.</strong> WWW'20 - RLIRank</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Paper Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="mb2-decomposed-behavior-modeling-for-self-driving-database-management-systems"><a class="header" href="#mb2-decomposed-behavior-modeling-for-self-driving-database-management-systems">MB2: Decomposed Behavior Modeling for Self-Driving Database Management Systems</a></h1>
<ul>
<li>Authors: Lin Ma, William Zhang, Jie Jiao, Wuwen Wang, Matthew Butrovich, Wan Shen Lim, Prashanth Menon, Andrew Pavlo</li>
<li>Institute: Carnegie Mellon University</li>
<li>Published at SIGMOD'21</li>
<li>Paper Link: <a href="https://dl.acm.org/doi/10.1145/3448016.3457276">https://dl.acm.org/doi/10.1145/3448016.3457276</a></li>
</ul>
<h2 id="background-creating-a-self-driving-dbms"><a class="header" href="#background-creating-a-self-driving-dbms">Background: Creating a Self-driving DBMS</a></h2>
<p>[51] proposes three main steps to build a self-driving DBMS:</p>
<ol>
<li>Workload forecasting
<ul>
<li>Predicting the future workloads</li>
</ul>
</li>
<li>Bahavior modeling
<ul>
<li>Predicting the runtime behavior relative to the target objective (latency, throughput) given the predicted workloads</li>
</ul>
</li>
<li>Decision making/planning
<ul>
<li>Selecting the actions to improve the objective</li>
</ul>
</li>
</ol>
<h2 id="motivation-behavior-modeling"><a class="header" href="#motivation-behavior-modeling">Motivation: Behavior Modeling</a></h2>
<h3 id="problem-formulation"><a class="header" href="#problem-formulation">Problem Formulation</a></h3>
<p>Input:</p>
<ul>
<li>The workload</li>
<li>The system state</li>
<li>An action</li>
</ul>
<p>Output:</p>
<ul>
<li>How long the action takes</li>
<li>How much resource the action consumes</li>
<li>How applying the action impacts the system performance</li>
<li>How the action impacts the system once it is deployed</li>
</ul>
<h3 id="current-approaches"><a class="header" href="#current-approaches">Current Approaches</a></h3>
<ul>
<li>White-box analytical methods [42, 45, 74]
<ul>
<li>Use a human-devised formula</li>
<li>Built for specific DBMSs
<ul>
<li>Different systems may use different formula</li>
</ul>
</li>
<li>Con: difficult to migrate to a new DBMS</li>
</ul>
</li>
<li>ML methods
<ul>
<li>Use a ML model</li>
<li>Pro: more scalable and adaptable</li>
<li>Cons
<ul>
<li>Only designed for query cost estimation
<ul>
<li>E.g., uses query plan to predict latency</li>
</ul>
</li>
<li>Current models do not consider OLTP workloads</li>
<li>Need accurate information for workloads (hard for predicting future workloads)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>The impact of creating a secondary index on the TPC-C workloads with 4 and 8 threads.</p>
<p><img src="lin2021mb2-fg1.png" alt="Figure 1" /></p>
<p>The behavior model must predict this impact with the given action.</p>
<h3 id="challenges"><a class="header" href="#challenges">Challenges</a></h3>
<ul>
<li>High dimensionality
<ul>
<li>Building a model to predict the performance of a DBMS must need a high-dimensional features, which impact the performance of the model.</li>
</ul>
</li>
<li>Concurrent operations
<ul>
<li>Many concurrent transactions must affect the predicted result.</li>
</ul>
</li>
<li>Training data collection v.s. Generalizability
<ul>
<li>To improve generalizability of a model, the system must collect more training data.</li>
<li>However, collecting training data also requires large amount of effort.</li>
</ul>
</li>
</ul>
<h2 id="related-work"><a class="header" href="#related-work">Related Work</a></h2>
<ul>
<li>ML Models
<ul>
<li>Mostly based on query plans</li>
<li>Needs to retrain the entire models if anything changes in the DBMS</li>
<li>Poor generalizability between workloads.</li>
<li>Focus on OLAP workloads</li>
</ul>
</li>
<li>Analytical Models
<ul>
<li>Mostly designed for a special purpose
<ul>
<li>for resource bottleneck</li>
<li>for cardinality estimation</li>
<li>for index defragmentation suggestions</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="goal"><a class="header" href="#goal">Goal</a></h2>
<p>To design a general behavior modeling method.</p>
<h3 id="assumptions"><a class="header" href="#assumptions">Assumptions</a></h3>
<ul>
<li>Workloads are predictable</li>
<li>In-memory DBMS with MVCC</li>
<li>Supporting both OLTP and OLAP workloads</li>
<li>Supporting capturing lock contention</li>
<li>Does not consider aborts due to data conflicts</li>
</ul>
<h2 id="method"><a class="header" href="#method">Method</a></h2>
<h3 id="main-idea"><a class="header" href="#main-idea">Main Idea</a></h3>
<p>Decomposing the DBMS into independent opearting units (OU), each of which represents a step to complete a specific task.</p>
<p>Then, MB2 creates a OU-runner and a OU-model for each OU:</p>
<ul>
<li>OU-runner: a runner to search input space, collect training data and train a model.</li>
<li>OU-model: a ML model for the OU.</li>
</ul>
<h3 id="flow"><a class="header" href="#flow">Flow</a></h3>
<p><img src="lin2021mb2-fg3.png" alt="Figure 3" /></p>
<ol>
<li>Given
<ul>
<li>a forecasted workloads</li>
<li>a candidate action</li>
</ul>
</li>
<li>Translating the action to features for OU</li>
<li>Making all OU-models to predict the results</li>
<li>Using an interference model to adjust the results</li>
<li>Merging the results to the predicted system performance</li>
</ol>
<h3 id="operating-units-ou"><a class="header" href="#operating-units-ou">Operating Units (OU)</a></h3>
<p>Key properties of an OUs:</p>
<ul>
<li>Independent: the runtime behavior of an OU is independent of other OUs.
<ul>
<li>E.g., Changing join hash table size does not affect WAL.</li>
</ul>
</li>
<li>Low dimensional: an model for an OU does not need many features to accurately predict the performance.
<ul>
<li>Insight: # of features = 10 is good</li>
<li>Divide an OU to multiple OUs if it needs more features.</li>
</ul>
</li>
<li>Comprehensive: OUs must cover all operations in a DBMS.</li>
</ul>
<p>OU Examples:</p>
<p><img src="lin2021mb2-tb1.png" alt="Table 1" /></p>
<p>OU Types:</p>
<ul>
<li>Singular: focus on work and resource consumption for a single invocation.</li>
<li>Batch: focus on a batch of work across OUs.</li>
<li>Contending: focus on the work that may contend with other threads</li>
</ul>
<h3 id="ou-models"><a class="header" href="#ou-models">OU-Models</a></h3>
<h4 id="input-features"><a class="header" href="#input-features">Input Features</a></h4>
<ul>
<li>Singular
<ul>
<li>number of input tuples</li>
<li>number of columns of input tuples</li>
<li>average input tuple size</li>
<li>estimated key cardinality (e.g., sorting, joins)</li>
<li>payload size (e.g., hash table entry size for hash join)</li>
<li>number of loops (for index nested loop joins)</li>
<li>is interpreter or JIT-compiled</li>
</ul>
</li>
<li>Batch
<ul>
<li>total number of bytes</li>
<li>total number of log buffers</li>
<li>log flush interval</li>
</ul>
</li>
<li>Contending
<ul>
<li>number of tuples</li>
<li>number of keys</li>
<li>size of keys</li>
<li>estimated cardinality of the keys</li>
<li>number of parallel threads</li>
</ul>
</li>
</ul>
<p>In addition to the above features, it also append tuneable configurations (knobs) for the OU to the features as inputs.</p>
<h4 id="output-labels"><a class="header" href="#output-labels">Output Labels</a></h4>
<ul>
<li>elapsed time</li>
<li>CPU time</li>
<li>CPU cycles</li>
<li>CPU instructions</li>
<li>CPU cache references</li>
<li>CPU cache misses</li>
<li>disk block reads</li>
<li>disk block writes</li>
<li>memory consumption</li>
</ul>
<p>Note that the labels are the same for all OUs, so that MB2 can combine them together easier.</p>
<h4 id="problems-of-collecting-data-with-olap-queries"><a class="header" href="#problems-of-collecting-data-with-olap-queries">Problems of collecting data with OLAP queries</a></h4>
<p>OLAP queries usually takes much more time to process, which lead to high overhead of collecting training data for them.</p>
<p>In order to overcome this, they normalize the output labels by the number of tuples so that we can train the model with queries that access less tuples.</p>
<p>The value is normalized according to the following observation:</p>
<ul>
<li>They observed that the value of output labels is usually a complexity related to n (number of tuples) times a constant.</li>
<li>So, they normalize the values by dividing the complexity.</li>
<li>A special case: memory consumption for building hash tables.</li>
</ul>
<h3 id="the-interference-model"><a class="header" href="#the-interference-model">The Interference Model</a></h3>
<p>To adjust the outputs of OU-models due to resource competition between OUs.</p>
<p><img src="lin2021mb2-fg4.png" alt="Figure 4" /></p>
<h4 id="key-ideas"><a class="header" href="#key-ideas">Key Ideas</a></h4>
<ul>
<li>Normalized the inputs by the elapsed time.</li>
<li>Predicting the ratio of the actual values and OU-model's predicted values.</li>
</ul>
<p>The key ideas is based on an observation:</p>
<blockquote>
<p>We observe that under the same concurrent environment,
OUs with similar per-time-unit OU-model estimation (part of the
interference model’s inputs) experience similar impacts and have
similar output ratios regardless of the absolute elapsed time.</p>
</blockquote>
<h4 id="inputs"><a class="header" href="#inputs">Inputs</a></h4>
<ul>
<li>A OU-model's output labels</li>
<li>Summary statistics of the OUs forecasted to run in the same time interval (e.g., 1 minute)
<ul>
<li>Sum</li>
<li>Variance</li>
</ul>
</li>
</ul>
<p>Normalized by dividing inputs by the target OU-model's estimated elapsed time.</p>
<h4 id="outputs"><a class="header" href="#outputs">Outputs</a></h4>
<p>Same output labels with the input OU-model, but the values are the ratio between actual metrics and the original predicted metrics. The ratios usually &gt;= 1 since an OU runs faster by itself.</p>
<h3 id="training-data-collection-and-training"><a class="header" href="#training-data-collection-and-training">Training Data Collection and Training</a></h3>
<p>Assumption: off-line</p>
<h4 id="components"><a class="header" href="#components">Components</a></h4>
<ul>
<li>OU Translator: translating queries and actions to OUs' inputs.</li>
<li>Resource Tracker: tracking the elapsed time and resource consumptions for each OU.
<ul>
<li>Use user- and kernel-level functions to track.</li>
</ul>
</li>
<li>OU-Runner: a microbenchmark to generate data for all possible inputs for each OU.
<ul>
<li>Inputs are generated in fixed-length and exponential step sizes.</li>
<li>MB2 will normalize the output labels, which greatly reduces the number of training data that need to be collected.</li>
<li>Can be executed concurrently with other OU-runners for training the inference model.
<ul>
<li>Parameters for using concurrent runners:
<ul>
<li>Which subsets of queries to execute</li>
<li>The number of concurrent threads in the DBMS</li>
<li>The workload submission rate.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="handling-the-inference-of-tracking-data-from-other-ous"><a class="header" href="#handling-the-inference-of-tracking-data-from-other-ous">Handling the inference of tracking data from other OUs</a></h4>
<p>Challenges when collecting training data:</p>
<ul>
<li>multiple threads produce metrics in the same time and thus requires coordination</li>
<li>too many resource tracker may incur a noticeable cost.</li>
</ul>
<p>These issues are addressed by:</p>
<ul>
<li>Makes each thread tracks their own metrics and uses a dedicated aggregator to gather these data and store together.</li>
<li>Turning off other OUs' resource tracker during collecting data.</li>
</ul>
<h4 id="challenges-for-collecting-data-for-oltp-queries"><a class="header" href="#challenges-for-collecting-data-for-oltp-queries">Challenges for collecting data for OLTP queries</a></h4>
<ul>
<li>High variance due to hardware (e.g., CPU scaling) and background noise (e.g., kernel tasks)
<ul>
<li>Solution: execute OU-runner for each OU with sufficient repetitions (10 times) and applies robust statistics.
<ul>
<li>Uses 20% trimmed mean statistics</li>
</ul>
</li>
</ul>
</li>
<li>A DBMS may execute OLTP queries as prepared statements
<ul>
<li>Solution: execute each query 5 times for warm-up</li>
</ul>
</li>
<li>Other details:
<ul>
<li>Starts a new transaction for each execution to avoid data residing in CPU caches.</li>
<li>If a query modifies database state, revert the query by rolling back the transaction.</li>
</ul>
</li>
</ul>
<p>Labels are insensitive to the trimmed mean percentage and number of warm-ups.</p>
<h4 id="models-selection"><a class="header" href="#models-selection">Models Selection</a></h4>
<p>MB2 selects and trains models for each OU and the inference model in the following steps:</p>
<ol>
<li>Split the training data to train/validation set (8:2)</li>
<li>Train the following models and perform cross-validation
<ul>
<li>Linear regression</li>
<li>Huber regression</li>
<li>SVM</li>
<li>Kernel regression</li>
<li>Random forest</li>
<li>Gradient boosting machine</li>
<li>Deep neural network</li>
</ul>
</li>
<li>Select the one with the highest validation score</li>
<li>Train the selected model with all available training data</li>
</ol>
<h4 id="for-system-updates"><a class="header" href="#for-system-updates">For system updates</a></h4>
<p>MB2 only needs to retrain the OU-models for the affected OUs.</p>
<h2 id="experiments"><a class="header" href="#experiments">Experiments</a></h2>
<h3 id="environment"><a class="header" href="#environment">Environment</a></h3>
<ul>
<li>Hardware:
<ul>
<li>2 x Intel Xeon E5-2630v4 CPUs (20 Cores)</li>
<li>128 GB RAM</li>
<li>Intel Optane DC P4800X SSD (NVMe)</li>
</ul>
</li>
<li>OS: Ubuntu 18.04 LTS</li>
<li>DBMS: NoisePage</li>
<li>ML Framework: scikit-learn
<ul>
<li>All parameters remain default:
<ul>
<li>Random forest: 50 estimators</li>
<li>Deep NN: 2 layers with 25 neurons</li>
<li>Gradient boosting machine: 20 depth &amp; 1000 leaves</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="benchmarks"><a class="header" href="#benchmarks">Benchmarks</a></h3>
<p>OLTP-Bench [13]:</p>
<ul>
<li>SmallBank: OLTP, 3 tables, 5 tx types
<ul>
<li>Models customers interacting with a bank branch</li>
</ul>
</li>
<li>TATP: OLTP, 4 tables, 7 tx types
<ul>
<li>Models cell phone registration service</li>
</ul>
</li>
<li>TPC-C: OLTP, 9 tables, 5 tx types
<ul>
<li>Models warehouses fulfilling orders</li>
</ul>
</li>
<li>TPC-H: OLAP, 8 tables, long-length queries
<ul>
<li>Models business analytics workload</li>
</ul>
</li>
</ul>
<h3 id="evaluation-metics"><a class="header" href="#evaluation-metics">Evaluation Metics</a></h3>
<ul>
<li>Relative Error: \(\frac{|Actual - Predict|}{Actual}\) for OLAP workloads</li>
<li>Average Absolute Error: \(|Actual - Predict|\) per OLTP query template</li>
</ul>
<h3 id="training-and-model-cost"><a class="header" href="#training-and-model-cost">Training and Model Cost</a></h3>
<p><img src="lin2021mb2-tb2.png" alt="Table 2" /></p>
<p>Key results:</p>
<ul>
<li>1M unique data points for 19 OUs</li>
<li>Average Inference time
<ul>
<li>OU translator for a query: 10 𝜇s</li>
<li>OU model for a query: 0.5 ms</li>
</ul>
</li>
<li>Average resource tracker invocation time: 20 𝜇s</li>
</ul>
<h3 id="ou-model-accuracy"><a class="header" href="#ou-model-accuracy">OU-Model Accuracy</a></h3>
<p><img src="lin2021mb2-fg5.png" alt="Figure 5" /></p>
<p>Key insights:</p>
<ul>
<li>More than 80% of the OU-models have an average error &lt; 20%</li>
<li>Transaction OU-models and probing an aggregation hash table have higher relative error because most cases have short elapsed time (&lt; 10 𝜇s), which leads to high variance.</li>
<li>Random forest and gradient boosting machine perform best</li>
<li>Deep NN have higher error because most of them overfit on low dimension data.</li>
<li>Huber regression is also effective for simple OUs and cheaper to train.</li>
</ul>
<p><img src="lin2021mb2-fg6.png" alt="Figure 6" /></p>
<p>Key insights:</p>
<ul>
<li>Most labels have an average error &lt; 20%</li>
<li>Predicting cache miss is challenging because it depends on the content in the cache</li>
<li>Normalization is effective</li>
</ul>
<h3 id="generalizability-on-query-runtime-prediction"><a class="header" href="#generalizability-on-query-runtime-prediction">Generalizability on Query Runtime Prediction</a></h3>
<p>Baseline: QPPNet [26, 40]</p>
<ul>
<li>A tree-structured neural network</li>
<li>The state-of-the-art on predicting query runtime</li>
<li>Generalizability is good</li>
<li>Disk-based</li>
</ul>
<p>Training Method</p>
<ul>
<li>For OLAP, training on TPC-H 1G data set and testing on all other OLAP workloads.</li>
<li>For OLTP, training on TPC-C data set and testing on all other OLTP workloads.</li>
</ul>
<p><img src="lin2021mb2-fg7.png" alt="Figure 7" /></p>
<p>Key insights:</p>
<ul>
<li>OLAP
<ul>
<li>QPPNet achieves competitive performance on the workload it trains on, but it has higher errors on other workloads.</li>
<li>MB2 achieve better and stable performance across all workloads because the fine-grained OUs design.</li>
<li>Output normalization technique helps.</li>
</ul>
</li>
<li>OLTP
<ul>
<li>MB2 has higher error on TPC-C, but it generalizes better to other workloads.</li>
<li>Output normalization does not help too much.</li>
</ul>
</li>
</ul>
<h3 id="the-interference-model-1"><a class="header" href="#the-interference-model-1">The Interference Model</a></h3>
<p>Settings:</p>
<ul>
<li>The interference model uses deep NN (which performs best).</li>
<li>Executes the queries in both single-thread and concurrent environments and compare the true adjustment factors against the predicted adjustment factors</li>
</ul>
<p><img src="lin2021mb2-fg8.png" alt="Figure 8" /></p>
<p>Key insights:</p>
<ul>
<li>The interference model has less than 20% error in all cases.</li>
<li>Small data set size results in higher variance in the interference, so the model has higher error.</li>
</ul>
<h3 id="model-adaptation-and-robustness"><a class="header" href="#model-adaptation-and-robustness">Model Adaptation and Robustness</a></h3>
<h4 id="system-updates"><a class="header" href="#system-updates">System Updates</a></h4>
<p>Settings:</p>
<ul>
<li>Simulate system updates of improving join hash table algorithm adding sleep time:
<ul>
<li>No sleep</li>
<li>Sleep 1 us very 1000 insertions</li>
<li>Sleep 1 us very 100 insertions</li>
</ul>
</li>
<li>MB2 retrains the OU-models for hash join
<ul>
<li>Takes 23 minutes (24x faster than retraining all OU-models)</li>
</ul>
</li>
</ul>
<p>They seems to put the wrong figure for this experiment. (Figure 9a)</p>
<h4 id="noisy-cardinality"><a class="header" href="#noisy-cardinality">Noisy Cardinality</a></h4>
<p>Settings:</p>
<ul>
<li>Add Gaussian white noise (mean = 0, variance = 30%) on cardinality estimation, which is an important input features for OU-models</li>
</ul>
<p><img src="lin2021mb2-fg9b.png" alt="Figure 9b" /></p>
<p>Key insights:</p>
<ul>
<li>Has almost no accuracy loss (&lt; 2%)</li>
</ul>
<h3 id="hardware-adaptability-by-adding-hardware-context-as-features"><a class="header" href="#hardware-adaptability-by-adding-hardware-context-as-features">Hardware Adaptability by Adding Hardware Context as Features</a></h3>
<p>Settings</p>
<ul>
<li>Adds CPU frequency as one of input features for OU-models</li>
<li>Tests OU-models trained using different CPU frequency (1.2 ~ 3.1 GHz)</li>
</ul>
<p><img src="lin2021mb2-fg10.png" alt="Figure 10" /></p>
<p>Key insights:</p>
<ul>
<li>Extending the OU-model with hardware context improves the prediction in most cases</li>
<li>A special case where it performs notably worse is for the TPC-C workload under 2.0 GHz CPU
<ul>
<li>Because the models generally over-predict the runtime of the TPC-C queries.</li>
</ul>
</li>
</ul>
<h3 id="end-to-end-self-driving-execution"><a class="header" href="#end-to-end-self-driving-execution">End-to-End Self-Driving Execution</a></h3>
<p>Settings:</p>
<ul>
<li>Assumes
<ul>
<li>a forecaster that forecasts the average query arrival rate per query type in the next 10 seconds.</li>
<li>a decision maker that uses the estimated information to decide how to adjust the system.</li>
</ul>
</li>
<li>Workloads: daily transactional-analytical workload cycle
<ul>
<li>TPC-C: 20 warehouses, 50000 customers per district</li>
<li>TPC-H: 1GB</li>
<li>10 concurrent threads</li>
</ul>
</li>
<li>Initial configurations that need to be updated
<ul>
<li>Interpretive mode (JIT works better)</li>
<li>No secondary index for customer tables</li>
</ul>
</li>
</ul>
<p>Goal: to see whether MB2 can accurately estimate the latency with given action plans.</p>
<p><img src="lin2021mb2-fg11a.png" alt="Figure 11a" /></p>
<p>With workload changes and the decisions (changing execution mode and building an index), MB2 accurately predicts the latency.</p>
<p><img src="lin2021mb2-fg11c.png" alt="Figure 11c" /></p>
<p>Even if we change the actions (building index with fewer threads), MB2 still manages to predict the latency accurately.</p>
<p><img src="lin2021mb2-fg11b.png" alt="Figure 11b" /></p>
<p>MB2 can also accurately predicts CPU utilization for each query.</p>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<ul>
<li>Provides many useful insights and techniques for latency estimation.</li>
<li>Solid experiments</li>
<li>Due to the assumption of in-memory DBMS and MVCC, there is no discussion on modeling behaviors for disk I/Os and lock contentions.</li>
</ul>
<h2 id="questions"><a class="header" href="#questions">Questions</a></h2>
<ul>
<li>Why does the paper emphasize &quot;To orchestrate data collection across all OUs and to simulate concurrent environments, MB2 uses concurrent runners to execute end-to-end workloads (e.g., benchmarks, query traces) with multiple threads.&quot;? What does &quot;concurrent runners&quot; mean?</li>
<li>What is &quot;robust statistics&quot;?</li>
<li>Is it possible to predict the latency of a query without specify what action to perform for MB2?</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../dbms_with_ai/zhou2020dbaisurvey.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../dbms_with_ai/hilprecht2022zeroshot.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../dbms_with_ai/zhou2020dbaisurvey.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../dbms_with_ai/hilprecht2022zeroshot.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
